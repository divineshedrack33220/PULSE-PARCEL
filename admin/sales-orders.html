<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>PULSE PARCLE | Sales & Orders</title>
    <link rel="icon" type="image/x-icon" href="/admin/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF7A2F',
                        dark: '#3A1F0B',
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-collapsed { width: 64px; }
        .sidebar-collapsed .nav-text { display: none; }
        .sidebar-collapsed .logo-text { display: none; }
        .sidebar-collapsed .nav-item { justify-content: center; }
        .dark .dark\:bg-dark { background-color: #1a120b; }
        .chart-container { position: relative; height: 300px; } /* Reduced size */
        .skeleton { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse {
            0%, 100% { opacity: .5; }
            50% { opacity: .2; }
        }
        .filter-title {
            font-size: 1.25rem; /* Reduced for smaller UI */
            border-bottom: 2px solid #FF7A2F;
            padding-bottom: 0.25rem;
        }
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .chart-container { height: 250px; }
            .filter-title { font-size: 1rem; }
            .metric-card { padding: 1rem; }
            .metric-card h3 { font-size: 1.5rem; }
        }
        @media (min-width: 641px) and (max-width: 1024px) {
            .chart-container { height: 280px; }
            .metric-card { padding: 1.25rem; }
        }
    </style>
    <script>
        // Anime.js scroll animation function
        function animateOnScroll() {
            const elements = document.querySelectorAll('.animate-on-scroll');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        anime({
                            targets: entry.target,
                            opacity: [0, 1],
                            translateY: [30, 0],
                            duration: 600,
                            easing: 'easeOutQuad',
                            complete: () => {
                                entry.target.style.opacity = '1';
                                entry.target.style.transform = 'translateY(0)';
                            }
                        });
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            elements.forEach(element => observer.observe(element));
        }

        document.addEventListener('DOMContentLoaded', animateOnScroll);
    </script>
</head>
<body class="bg-gray-50 dark:bg-dark text-dark dark:text-gray-200 transition-colors duration-300">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="w-64 sm:w-56 md:w-64 bg-white dark:bg-gray-800 shadow-lg flex flex-col transition-all duration-300">
            <div class="p-4 flex items-center border-b border-gray-200 dark:border-gray-700">
                <div class="w-10 h-10 rounded-full  flex items-center justify-center">
                   <img src="static/WhatsApp_Image_2025-11-14_at_15.22.15_e0a3a264-removebg-preview.png" ... >
                </div>
                <span class="logo-text ml-3 font-bold text-xl">PULSE PARCLE</span>
            </div>
            <div class="flex-1 overflow-y-auto py-4">
                  <nav>
                    <div class="px-2">
                        <div class="nav-item mb-1">
                            <a href="/admin/index.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i data-feather="home"></i>
                                <span class="nav-text ml-3">Dashboard</span>
                            </a>
                        </div>
                        <div class="nav-item mb-1">
                            <a href="/admin/visitors.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i data-feather="users"></i>
                                <span class="nav-text ml-3">Visitors</span>
                            </a>
                        </div>
                        <div class="nav-item mb-1">
                            <a href="/admin/ads-marketing.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i data-feather="dollar-sign"></i>
                                <span class="nav-text ml-3">Ads & Marketing</span>
                            </a>
                        </div>
                        <div class="nav-item mb-1">
                            <a href="/admin/sales-orders.html" class="flex items-center px-4 py-3 rounded-lg bg-primary bg-opacity-10 text-primary">
                                <i data-feather="shopping-bag"></i>
                                <span class="nav-text ml-3">Sales & Orders</span>
                            </a>
                        </div>
                        <div class="nav-item mb-1">
                            <a href="/admin/products.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i data-feather="package"></i>
                                <span class="nav-text ml-3">Products</span>
                            </a>
                        </div>
                        <div class="nav-item mb-1">
                            <a href="/admin/customers.html" class="flex items-center px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                                <i data-feather="user"></i>
                                <span class="nav-text ml-3">Customers</span>
                            </a>
                        </div>
                       
                    </div>
                </nav>
            </div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center">
                        <i data-feather="user" class="text-white w-5 h-5"></i>
                    </div>
                    <div class="ml-3">
                        <div id="admin-name" class="font-medium text-base">Admin User</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">Super Admin</div>
                    </div>
                    <button id="theme-toggle" class="ml-auto p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i data-feather="moon" class="w-5 h-5 hidden dark:block"></i>
                        <i data-feather="sun" class="w-5 h-5 dark:hidden"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <header class="bg-white dark:bg-gray-800 shadow-sm">
                <div class="px-6 py-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <button id="sidebar-toggle" class="mr-4 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i data-feather="menu" class="w-5 h-5"></i>
                        </button>
                        <h1 class="text-xl font-semibold">Sales & Orders</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 relative">
                            <i data-feather="bell" class="w-5 h-5"></i>
                            <span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span>
                        </button>
                        <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i data-feather="message-square" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            </header>

            <main class="p-6">
                <div id="error-message" class="hidden text-red-500 text-sm mb-4 text-center"></div>

                <!-- Filters -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6 animate-on-scroll">
                    <h2 class="font-semibold mb-4 filter-title">Filter Orders</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm text-gray-500 dark:text-gray-400">Status</label>
                            <select id="filter-status" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="">All Statuses</option>
                                <option value="Placed">Placed</option>
                                <option value="Packed">Packed</option>
                                <option value="In Transit">In Transit</option>
                                <option value="Delivered">Delivered</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="applyFilters()" class="w-full px-4 py-2 bg-primary text-white rounded-lg text-sm">Apply Filters</button>
                        </div>
                        <div class="flex items-end">
                            <button onclick="window.location.href='/admin/manage-orders.html'" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg text-sm">Manage Orders</button>
                        </div>
                    </div>
                </div>

                <!-- Metrics Cards -->
                <div class="mb-6">
                    <h2 class="font-semibold text-lg mb-4">Order Metrics</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-primary animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Total Orders</p>
                                    <h3 id="total-orders" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="orders-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-primary bg-opacity-10">
                                    <i data-feather="shopping-bag" class="text-primary w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-green-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Completed Orders</p>
                                    <h3 id="completed-orders" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="completed-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-green-500 bg-opacity-10">
                                    <i data-feather="check-circle" class="text-green-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-yellow-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Pending Orders</p>
                                    <h3 id="pending-orders" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="pending-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-yellow-500 bg-opacity-10">
                                    <i data-feather="clock" class="text-yellow-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-red-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Cancelled/Refunded Orders</p>
                                    <h3 id="cancelled-orders" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="cancelled-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-red-500 bg-opacity-10">
                                    <i data-feather="x-circle" class="text-red-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-blue-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Avg Order Value</p>
                                    <h3 id="avg-order-value" class="text-2xl font-bold mt-1 skeleton">₦0</h3>
                                    <p id="avg-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-blue-500 bg-opacity-10">
                                    <i data-feather="bar-chart" class="text-blue-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-purple-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Total Revenue</p>
                                    <h3 id="total-revenue" class="text-2xl font-bold mt-1 skeleton">₦0</h3>
                                    <p id="revenue-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-purple-500 bg-opacity-10">
                                    <i data-feather="dollar-sign" class="text-purple-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-teal-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Net Revenue</p>
                                    <h3 id="net-revenue" class="text-2xl font-bold mt-1 skeleton">₦0</h3>
                                    <p id="net-revenue-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-teal-500 bg-opacity-10">
                                    <i data-feather="dollar-sign" class="text-teal-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-indigo-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Gross Merchandise Value</p>
                                    <h3 id="gmv" class="text-2xl font-bold mt-1 skeleton">₦0</h3>
                                    <p id="gmv-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-indigo-500 bg-opacity-10">
                                    <i data-feather="shopping-cart" class="text-indigo-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-pink-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Conversion Rate</p>
                                    <h3 id="conversion-rate" class="text-2xl font-bold mt-1 skeleton">0%</h3>
                                    <p id="conversion-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-pink-500 bg-opacity-10">
                                    <i data-feather="percent" class="text-pink-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h2 class="font-semibold text-lg mt-6 mb-4">Customer Metrics</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-cyan-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">New Customers</p>
                                    <h3 id="new-customers" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="new-customers-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-cyan-500 bg-opacity-10">
                                    <i data-feather="user-plus" class="text-cyan-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-orange-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Returning Customers</p>
                                    <h3 id="returning-customers" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="returning-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-orange-500 bg-opacity-10">
                                    <i data-feather="user-check" class="text-orange-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-lime-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Customer Lifetime Value</p>
                                    <h3 id="clv" class="text-2xl font-bold mt-1 skeleton">₦0</h3>
                                    <p id="clv-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-lime-500 bg-opacity-10">
                                    <i data-feather="dollar-sign" class="text-lime-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-amber-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Customer Acquisition Cost</p>
                                    <h3 id="cac" class="text-2xl font-bold mt-1 skeleton">₦0</h3>
                                    <p id="cac-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-amber-500 bg-opacity-10">
                                    <i data-feather="dollar-sign" class="text-amber-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-emerald-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Customer Retention Rate</p>
                                    <h3 id="retention-rate" class="text-2xl font-bold mt-1 skeleton">0%</h3>
                                    <p id="retention-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-emerald-500 bg-opacity-10">
                                    <i data-feather="percent" class="text-emerald-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h2 class="font-semibold text-lg mt-6 mb-4">Product Metrics</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-violet-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Best-Selling Products</p>
                                    <h3 id="best-selling" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="best-selling-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-violet-500 bg-opacity-10">
                                    <i data-feather="package" class="text-violet-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-rose-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Low-Selling/Dead Stock</p>
                                    <h3 id="low-selling" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="low-selling-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-rose-500 bg-opacity-10">
                                    <i data-feather="package" class="text-rose-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-fuchsia-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Product Return Rate</p>
                                    <h3 id="return-rate" class="text-2xl font-bold mt-1 skeleton">0%</h3>
                                    <p id="return-rate-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-fuchsia-500 bg-opacity-10">
                                    <i data-feather="rotate-ccw" class="text-fuchsia-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-blue-600 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Inventory Turnover Rate</p>
                                    <h3 id="inventory-turnover" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="inventory-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-blue-600 bg-opacity-10">
                                    <i data-feather="refresh-cw" class="text-blue-600 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h2 class="font-semibold text-lg mt-6 mb-4">Payment & Transaction Metrics</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-red-600 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Failed Payments</p>
                                    <h3 id="failed-payments" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="failed-payments-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-red-600 bg-opacity-10">
                                    <i data-feather="x-circle" class="text-red-600 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-orange-600 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Refund Amounts</p>
                                    <h3 id="refund-amounts" class="text-2xl font-bold mt-1 skeleton">₦0</h3>
                                    <p id="refund-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-orange-600 bg-opacity-10">
                                    <i data-feather="dollar-sign" class="text-orange-600 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-purple-600 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Chargeback Rate</p>
                                    <h3 id="chargeback-rate" class="text-2xl font-bold mt-1 skeleton">0%</h3>
                                    <p id="chargeback-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-purple-600 bg-opacity-10">
                                    <i data-feather="percent" class="text-purple-600 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h2 class="font-semibold text-lg mt-6 mb-4">Time-Based Metrics</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-blue-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Orders (Day)</p>
                                    <h3 id="orders-day" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="orders-day-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-blue-500 bg-opacity-10">
                                    <i data-feather="calendar" class="text-blue-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-green-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Orders (Week)</p>
                                    <h3 id="orders-week" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="orders-week-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-green-500 bg-opacity-10">
                                    <i data-feather="calendar" class="text-green-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-yellow-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Orders (Month)</p>
                                    <h3 id="orders-month" class="text-2xl font-bold mt-1 skeleton">0</h3>
                                    <p id="orders-month-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-yellow-500 bg-opacity-10">
                                    <i data-feather="calendar" class="text-yellow-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-orange-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Peak Sales Hours</p>
                                    <h3 id="peak-hours" class="text-2xl font-bold mt-1 skeleton">N/A</h3>
                                    <p id="peak-hours-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-orange-500 bg-opacity-10">
                                    <i data-feather="clock" class="text-orange-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 border-l-4 border-purple-500 animate-on-scroll metric-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Average Processing Time</p>
                                    <h3 id="avg-processing-time" class="text-2xl font-bold mt-1 skeleton">0 hrs</h3>
                                    <p id="processing-trend" class="text-sm text-green-500 flex items-center mt-1">
                                        <i data-feather="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Loading...</span>
                                    </p>
                                </div>
                                <div class="p-3 rounded-lg bg-purple-500 bg-opacity-10">
                                    <i data-feather="clock" class="text-purple-500 w-5 h-5"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="mb-6">
                    <h2 class="font-semibold text-lg mb-4 filter-title">Analytics</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Order Status Distribution</h3>
                            <canvas id="statusChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Sales Over Time</h3>
                            <canvas id="salesChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Best-Selling Products</h3>
                            <canvas id="bestSellingChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Payment Method Breakdown</h3>
                            <canvas id="paymentChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">New vs Returning Customers</h3>
                            <canvas id="customerTypeChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Order Status Comparison</h3>
                            <canvas id="stackedStatusChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Peak Order Times</h3>
                            <canvas id="peakTimesChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Cumulative Revenue</h3>
                            <canvas id="cumulativeRevenueChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Conversion Funnel</h3>
                            <canvas id="funnelChart"></canvas>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 chart-container animate-on-scroll">
                            <h3 class="font-semibold text-base mb-3">Geographic Distribution</h3>
                            <div id="geoMapChart" class="text-center">Geo Map Chart (Requires Leaflet or D3.js)</div>
                        </div>
                    </div>
                </div>

                <!-- Order Modal -->
                <div id="order-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md sm:max-w-lg">
                        <h2 id="order-modal-title" class="text-xl font-semibold mb-4">Order Details</h2>
                        <form id="order-form">
                            <div class="mb-4">
                                <label class="block text-sm text-gray-500 dark:text-gray-400">Order Number</label>
                                <input id="order-number" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-sm" readonly>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm text-gray-500 dark:text-gray-400">Customer</label>
                                <input id="order-customer" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-sm" readonly>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm text-gray-500 dark:text-gray-400">Total</label>
                                <input id="order-total" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-sm" readonly>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm text-gray-500 dark:text-gray-400">Status</label>
                                <select id="order-status" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-primary">
                                    <option value="Placed">Placed</option>
                                    <option value="Packed">Packed</option>
                                    <option value="In Transit">In Transit</option>
                                    <option value="Delivered">Delivered</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm text-gray-500 dark:text-gray-400">Date</label>
                                <input id="order-date" class="w-full p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-sm" readonly>
                            </div>
                            <div class="flex justify-end space-x-4">
                                <button type="button" onclick="closeOrderModal()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm">Cancel</button>
                                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg text-sm">Save</button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- JavaScript Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" onerror="loadLocalAnime()"></script>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        const DEBUG = true;

        function loadLocalAnime() {
            console.warn('Anime.js CDN failed, attempting to load local Anime.js');
            const script = document.createElement('script');
            script.src = '/admin/static/anime.min.js';
            script.onerror = () => console.error('Failed to load local Anime.js');
            document.body.appendChild(script);
        }

        function getTimeAgo(date) {
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            if (seconds < 60) return `${seconds} seconds ago`;
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes} minute${minutes === 1 ? '' : 's'} ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} hour${hours === 1 ? '' : 's'} ago`;
            const days = Math.floor(hours / 24);
            if (days < 30) return `${days} day${days === 1 ? '' : 's'} ago`;
            const months = Math.floor(days / 30);
            if (months < 12) return `${months} month${months === 1 ? '' : 's'} ago`;
            const years = Math.floor(months / 12);
            return `${years} year${years === 1 ? '' : 's'} ago`;
        }

        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            const html = document.documentElement;
            themeToggle.addEventListener('click', () => {
                html.classList.toggle('dark');
                localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
                console.log('Theme toggled:', html.classList.contains('dark') ? 'dark' : 'light');
                if (typeof feather !== 'undefined') feather.replace();
            });
        } else {
            console.warn('Theme toggle element not found (ID: theme-toggle)');
        }

        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('sidebar-collapsed');
                console.log('Sidebar toggled:', sidebar.classList.contains('sidebar-collapsed') ? 'collapsed' : 'expanded');
            });
        } else {
            console.warn('Sidebar toggle elements missing:', { sidebarToggle: !!sidebarToggle, sidebar: !!sidebar });
        }

        function showError(message) {
            console.error('Error:', message);
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
                if (typeof anime !== 'undefined') {
                    anime({
                        targets: '#error-message',
                        opacity: [0, 1],
                        translateY: [-10, 0],
                        duration: 400,
                        easing: 'easeOutQuad'
                    });
                    setTimeout(() => {
                        anime({
                            targets: '#error-message',
                            opacity: [1, 0],
                            translateY: [0, -10],
                            duration: 400,
                            easing: 'easeInQuad',
                            complete: () => errorMessage.classList.add('hidden')
                        });
                    }, 4000);
                } else {
                    console.warn('Anime.js not loaded, skipping error animation');
                    setTimeout(() => errorMessage.classList.add('hidden'), 4000);
                }
            } else {
                console.warn('Error message element not found (ID: error-message). Displaying alert instead.');
                alert(message);
            }
        }

        async function connectMetaMask() {
            if (typeof window.ethereum === 'undefined') {
                console.warn('MetaMask is not installed');
                showError('MetaMask is not installed. Please install it from https://metamask.io.');
                window.open('https://metamask.io/download.html', '_blank');
                return null;
            }
            if (!window.ethereum.isMetaMask) {
                console.warn('Detected a non-MetaMask provider');
                showError('Detected a non-MetaMask provider. Please use MetaMask.');
                return null;
            }
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                console.log('Connected to MetaMask:', accounts[0]);
                return accounts[0];
            } catch (error) {
                console.error('MetaMask connection error:', error.message);
                showError('Failed to connect to MetaMask: ' + error.message);
                return null;
            }
        }

        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                console.error('No token found in localStorage');
                showError('No authentication token found. Please log in.');
                window.location.href = '/admin/login.html';
                return false;
            }
            try {
                console.log('Checking authentication with token:', token.substring(0, 10) + '...');
                const response = await fetch(`${API_BASE_URL}/users/profile`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Profile fetch failed: ${response.status} ${response.statusText} - ${errorText}`);
                }
                const data = await response.json();
                if (!data.isAdmin) {
                    console.error('User is not an admin:', data);
                    localStorage.removeItem('token');
                    showError('You do not have admin privileges.');
                    window.location.href = '/admin/login.html';
                    return false;
                }
                console.log('Admin authenticated:', data.name);
                const adminName = document.getElementById('admin-name');
                if (adminName) {
                    adminName.textContent = data.name || 'Admin User';
                } else {
                    console.warn('Admin name element not found (ID: admin-name)');
                }
                return token;
            } catch (error) {
                console.error('Auth check error:', error.message);
                showError('Authentication failed. Please log in again.');
                localStorage.removeItem('token');
                window.location.href = '/admin/login.html';
                return false;
            }
        }

        let socket;
        function initWebSocket(token) {
            try {
                socket = io('http://localhost:5000');
                socket.on('connect', () => {
                    console.log('WebSocket connected, joining admin channel');
                    socket.emit('joinAdmin', `Bearer ${token}`);
                });
                socket.on('connect_error', (error) => {
                    console.error('WebSocket connection error:', error);
                    showError('Failed to connect to real-time updates. Please refresh.');
                });
                socket.on('newOrder', () => {
                    console.log('New order received via WebSocket');
                    loadMetrics();
                });
                socket.on('orderUpdate', () => {
                    console.log('Order update received via WebSocket');
                    loadCharts();
                    loadMetrics();
                });
            } catch (error) {
                console.error('WebSocket initialization error:', error);
                showError('Failed to initialize WebSocket. Real-time updates disabled.');
            }
        }

        function formatCurrency(amount) {
            return `₦${(amount || 0).toLocaleString()}`;
        }

        function applyFilters() {
            console.log('Applying filters, status:', document.getElementById('filter-status')?.value);
            window.location.href = '/admin/manage-orders.html?status=' + encodeURIComponent(document.getElementById('filter-status')?.value || '');
        }

        async function loadMetrics() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_BASE_URL}/orders/metrics`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error(`Failed to fetch metrics: ${response.status} ${response.statusText}`);
                const data = await response.json();

                const updateElement = (id, value) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                        element.classList.remove('skeleton');
                    } else {
                        console.warn(`Element not found: ${id}`);
                    }
                };
                updateElement('total-orders', data.totalOrders.toLocaleString());
                updateElement('completed-orders', data.completedOrders.toLocaleString());
                updateElement('pending-orders', data.pendingOrders.toLocaleString());
                updateElement('cancelled-orders', data.cancelledOrders.toLocaleString());
                updateElement('avg-order-value', formatCurrency(data.avgOrderValue.toFixed(2)));
                updateElement('total-revenue', formatCurrency(data.totalRevenue));
                updateElement('net-revenue', formatCurrency(data.netRevenue));
                updateElement('gmv', formatCurrency(data.gmv));
                updateElement('conversion-rate', `${data.conversionRate}%`);
                updateElement('new-customers', data.newCustomers.toLocaleString());
                updateElement('returning-customers', data.returningCustomers.toLocaleString());
                updateElement('clv', formatCurrency(data.clv.toFixed(2)));
                updateElement('cac', formatCurrency(data.cac));
                updateElement('retention-rate', `${data.retentionRate}%`);
                updateElement('best-selling', data.bestSellingProducts.length.toLocaleString());
                updateElement('low-selling', data.lowSellingProducts.length.toLocaleString());
                updateElement('return-rate', `${data.returnRate.toFixed(2)}%`);
                updateElement('inventory-turnover', data.inventoryTurnover.toFixed(2));
                updateElement('failed-payments', data.failedPayments.toLocaleString());
                updateElement('refund-amounts', formatCurrency(data.refundAmounts));
                updateElement('chargeback-rate', `${data.chargebackRate}%`);
                updateElement('orders-day', data.ordersByDay.toLocaleString());
                updateElement('orders-week', data.ordersByWeek.toLocaleString());
                updateElement('orders-month', data.ordersByMonth.toLocaleString());
                updateElement('peak-hours', data.peakSalesHours);
                updateElement('avg-processing-time', `${data.avgProcessingTime.toFixed(2)} hrs`);

                const updateTrend = (id, value) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.innerHTML = `<i data-feather="${value >= 0 ? 'trending-up' : 'trending-down'}" class="w-4 h-4 mr-1"></i>Updated`;
                        element.classList.toggle('text-green-500', value >= 0);
                        element.classList.toggle('text-red-500', value < 0);
                    } else {
                        console.warn(`Trend element not found: ${id}`);
                    }
                };
                updateTrend('orders-trend', 0);
                updateTrend('completed-trend', 0);
                updateTrend('pending-trend', 0);
                updateTrend('cancelled-trend', 0);
                updateTrend('avg-trend', 0);
                updateTrend('revenue-trend', 0);
                updateTrend('net-revenue-trend', 0);
                updateTrend('gmv-trend', 0);
                updateTrend('conversion-trend', 0);
                updateTrend('new-customers-trend', 0);
                updateTrend('returning-trend', 0);
                updateTrend('clv-trend', 0);
                updateTrend('cac-trend', 0);
                updateTrend('retention-trend', 0);
                updateTrend('best-selling-trend', 0);
                updateTrend('low-selling-trend', 0);
                updateTrend('return-rate-trend', 0);
                updateTrend('inventory-trend', 0);
                updateTrend('failed-payments-trend', 0);
                updateTrend('refund-trend', 0);
                updateTrend('chargeback-trend', 0);
                updateTrend('orders-day-trend', 0);
                updateTrend('orders-week-trend', 0);
                updateTrend('orders-month-trend', 0);
                updateTrend('peak-hours-trend', 0);
                updateTrend('processing-trend', 0);

                if (typeof feather !== 'undefined') feather.replace();
            } catch (error) {
                console.error('Error loading metrics:', error);
                showError('Failed to load metrics. Please try again.');
            }
        }

        async function loadCharts(period = '30d') {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_BASE_URL}/orders/charts?period=${period}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error(`Failed to fetch chart data: ${response.status} ${response.statusText}`);
                const data = await response.json();

                const chartIds = [
                    'statusChart', 'salesChart', 'bestSellingChart', 'paymentChart',
                    'customerTypeChart', 'stackedStatusChart', 'peakTimesChart',
                    'cumulativeRevenueChart', 'funnelChart'
                ];
                chartIds.forEach(id => {
                    const chartInstance = Chart.getChart(id);
                    if (chartInstance) chartInstance.destroy();
                });

                const statusChartCtx = document.getElementById('statusChart')?.getContext('2d');
                if (statusChartCtx) {
                    new Chart(statusChartCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Placed', 'Packed', 'In Transit', 'Delivered', 'Cancelled'],
                            datasets: [{
                                data: [
                                    data.statusCounts?.Placed || 0,
                                    data.statusCounts?.Packed || 0,
                                    data.statusCounts?.['In Transit'] || 0,
                                    data.statusCounts?.Delivered || 0,
                                    data.statusCounts?.Cancelled || 0
                                ],
                                backgroundColor: ['#FF7A2F', '#FBBF24', '#3B82F6', '#10B981', '#EF4444'],
                                borderColor: ['#3A1F0B', '#3A1F0B', '#3A1F0B', '#3A1F0B', '#3A1F0B'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom', labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Status chart canvas not found (ID: statusChart)');
                }

                const salesChartCtx = document.getElementById('salesChart')?.getContext('2d');
                if (salesChartCtx) {
                    new Chart(salesChartCtx, {
                        type: 'line',
                        data: {
                            labels: data.salesOverTime?.labels || [],
                            datasets: [{
                                label: 'Sales (₦)',
                                data: data.salesOverTime?.data || [],
                                borderColor: '#FF7A2F',
                                backgroundColor: 'rgba(255, 122, 47, 0.2)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: 'Revenue (₦)', font: { size: 12 } } },
                                x: { title: { display: true, text: 'Date', font: { size: 12 } } }
                            },
                            plugins: {
                                legend: { position: 'top', labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Sales chart canvas not found (ID: salesChart)');
                }

                const bestSellingChartCtx = document.getElementById('bestSellingChart')?.getContext('2d');
                if (bestSellingChartCtx) {
                    new Chart(bestSellingChartCtx, {
                        type: 'bar',
                        data: {
                            labels: data.bestSellingProducts?.map(p => p.name) || [],
                            datasets: [{
                                label: 'Units Sold',
                                data: data.bestSellingProducts?.map(p => p.unitsSold) || [],
                                backgroundColor: '#10B981',
                                borderColor: '#3A1F0B',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: 'Units Sold', font: { size: 12 } } },
                                x: { title: { display: true, text: 'Product', font: { size: 12 } } }
                            },
                            plugins: {
                                legend: { labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Best-selling chart canvas not found (ID: bestSellingChart)');
                }

                const paymentChartCtx = document.getElementById('paymentChart')?.getContext('2d');
                if (paymentChartCtx) {
                    new Chart(paymentChartCtx, {
                        type: 'pie',
                        data: {
                            labels: data.paymentMethods?.map(p => p.method) || [],
                            datasets: [{
                                data: data.paymentMethods?.map(p => p.count) || [],
                                backgroundColor: ['#3B82F6', '#10B981', '#FBBF24', '#EF4444'],
                                borderColor: ['#3A1F0B', '#3A1F0B', '#3A1F0B', '#3A1F0B'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom', labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Payment chart canvas not found (ID: paymentChart)');
                }

                const customerTypeChartCtx = document.getElementById('customerTypeChart')?.getContext('2d');
                if (customerTypeChartCtx) {
                    new Chart(customerTypeChartCtx, {
                        type: 'pie',
                        data: {
                            labels: ['New Customers', 'Returning Customers'],
                            datasets: [{
                                data: [data.newCustomers || 0, data.returningCustomers || 0],
                                backgroundColor: ['#3B82F6', '#10B981'],
                                borderColor: ['#3A1F0B', '#3A1F0B'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom', labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Customer type chart canvas not found (ID: customerTypeChart)');
                }

                const stackedStatusChartCtx = document.getElementById('stackedStatusChart')?.getContext('2d');
                if (stackedStatusChartCtx) {
                    new Chart(stackedStatusChartCtx, {
                        type: 'bar',
                        data: {
                            labels: data.statusByPeriod?.labels || [],
                            datasets: [
                                {
                                    label: 'Completed',
                                    data: data.statusByPeriod?.completed || [],
                                    backgroundColor: '#10B981'
                                },
                                {
                                    label: 'Pending',
                                    data: data.statusByPeriod?.pending || [],
                                    backgroundColor: '#FBBF24'
                                },
                                {
                                    label: 'Cancelled',
                                    data: data.statusByPeriod?.cancelled || [],
                                    backgroundColor: '#EF4444'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { stacked: true, title: { display: true, text: 'Date', font: { size: 12 } } },
                                y: { stacked: true, beginAtZero: true, title: { display: true, text: 'Orders', font: { size: 12 } } }
                            },
                            plugins: {
                                legend: { labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Stacked status chart canvas not found (ID: stackedStatusChart)');
                }

                const peakTimesChartCtx = document.getElementById('peakTimesChart')?.getContext('2d');
                if (peakTimesChartCtx) {
                    new Chart(peakTimesChartCtx, {
                        type: 'bar',
                        data: {
                            labels: data.peakTimes?.map(p => `${p.hour}:00`) || [],
                            datasets: [{
                                label: 'Orders',
                                data: data.peakTimes?.map(p => p.count) || [],
                                backgroundColor: '#3B82F6',
                                borderColor: '#3A1F0B',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: 'Orders', font: { size: 12 } } },
                                x: { title: { display: true, text: 'Hour', font: { size: 12 } } }
                            },
                            plugins: {
                                legend: { labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Peak times chart canvas not found (ID: peakTimesChart)');
                }

                const cumulativeRevenueChartCtx = document.getElementById('cumulativeRevenueChart')?.getContext('2d');
                if (cumulativeRevenueChartCtx) {
                    new Chart(cumulativeRevenueChartCtx, {
                        type: 'line',
                        data: {
                            labels: data.cumulativeRevenue?.labels || [],
                            datasets: [{
                                label: 'Cumulative Revenue (₦)',
                                data: data.cumulativeRevenue?.data?.map(d => d.total) || [],
                                borderColor: '#FF7A2F',
                                backgroundColor: 'rgba(255, 122, 47, 0.2)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: 'Revenue (₦)', font: { size: 12 } } },
                                x: { title: { display: true, text: 'Date', font: { size: 12 } } }
                            },
                            plugins: {
                                legend: { labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Cumulative revenue chart canvas not found (ID: cumulativeRevenueChart)');
                }

                const funnelChartCtx = document.getElementById('funnelChart')?.getContext('2d');
                if (funnelChartCtx) {
                    new Chart(funnelChartCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Visitors', 'Add to Cart', 'Checkout', 'Successful Payment'],
                            datasets: [{
                                label: 'Funnel',
                                data: [
                                    data.funnel?.visitors || 0,
                                    data.funnel?.addToCart || 0,
                                    data.funnel?.checkout || 0,
                                    data.funnel?.successfulPayment || 0
                                ],
                                backgroundColor: ['#3B82F6', '#FBBF24', '#10B981', '#FF7A2F']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { beginAtZero: true, title: { display: true, text: 'Count', font: { size: 12 } } },
                                x: { title: { display: true, text: 'Stage', font: { size: 12 } } }
                            },
                            plugins: {
                                legend: { labels: { font: { size: 12 } } }
                            }
                        }
                    });
                } else {
                    console.warn('Funnel chart canvas not found (ID: funnelChart)');
                }

                console.log('Charts initialized for period:', period);
                if (typeof feather !== 'undefined') feather.replace();
            } catch (error) {
                console.error('Error loading charts:', error);
                showError('Failed to load charts. Please try again.');
            }
        }

        function openOrderModal(order) {
            const modal = document.getElementById('order-modal');
            if (!modal) {
                console.warn('Order modal not found (ID: order-modal)');
                return;
            }
            document.getElementById('order-number').value = order.orderNumber || '';
            document.getElementById('order-customer').value = order.customer || '';
            document.getElementById('order-total').value = formatCurrency(order.total || 0);
            document.getElementById('order-status').value = order.status || 'Placed';
            document.getElementById('order-date').value = order.date ? new Date(order.date).toLocaleString() : '';
            modal.classList.remove('hidden');
            console.log('Order modal opened for order:', order.orderNumber);

            const form = document.getElementById('order-form');
            if (form) {
                form.onsubmit = async (e) => {
                    e.preventDefault();
                    const updatedStatus = document.getElementById('order-status').value;
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`${API_BASE_URL}/orders/${order.orderNumber}`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ status: updatedStatus })
                        });
                        if (!response.ok) throw new Error(`Failed to update order: ${response.status} ${response.statusText}`);
                        console.log(`Order ${order.orderNumber} updated to status: ${updatedStatus}`);
                        closeOrderModal();
                        loadCharts();
                        loadMetrics();
                    } catch (error) {
                        console.error('Error updating order:', error);
                        showError('Failed to update order. Please try again.');
                    }
                };
            } else {
                console.warn('Order form not found (ID: order-form)');
            }
        }

        function closeOrderModal() {
            const modal = document.getElementById('order-modal');
            if (modal) {
                modal.classList.add('hidden');
                console.log('Order modal closed');
            } else {
                console.warn('Order modal not found (ID: order-modal)');
            }
        }

        async function init() {
            try {
                console.log('Initializing page...');
                if (typeof feather !== 'undefined') {
                    feather.replace();
                    console.log('Feather icons initialized');
                } else {
                    console.warn('Feather icons not loaded');
                }
                const token = await checkAuth();
                if (!token) return;
                initWebSocket(token);
                await Promise.all([
                    loadMetrics(),
                    loadCharts()
                ]);
                console.log('Page initialization complete');
            } catch (error) {
                console.error('Initialization error:', error);
                showError('Failed to initialize page. Please refresh.');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            init();
            console.log('DOM content loaded, initialization triggered');
        });
    </script>
</body>
</html>